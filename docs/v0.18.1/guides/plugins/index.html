<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">

	<title></title>

        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/purebasic.min.css">
        <!-- <link href="../../css/bootstrap-custom.min.css" rel="stylesheet"> -->
        <!-- <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet"> -->
        <!-- <link rel="stylesheet" href="../../css/highlight.css"> -->
        <!-- <link href="../../css/base.css" rel="stylesheet"> -->
        <link href="../../opaldocs.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

    </head>

    <body>
        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="">
              <img src="/img/opallogo.png" height="30"/>
            </a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li >
                    <a href="../..">Home</a>
                </li>
            
            
            
                <li >
                    <a href="../../installation/">Installation</a>
                </li>
            
            
            
                <li >
                    <a href="../../tutorial/">Tutorial</a>
                </li>
            
            
            
                <!-- <li class="dropdown"> -->
                <!--     <a href="#" class="dropdown-toggle" data-toggle="dropdown">Tutorials <b class="caret"></b></a> -->
                <!--     <ul class="dropdown-menu"> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="tutorials/pathway_tutorial/">Tutorial: Creating forms with Opal</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="tutorials/theming_tutorial/">Customising the design of your application</a> -->
                <!--         </li> -->
                <!--      -->
                <!--     </ul> -->
                <!-- </li> -->
            
            
            
                <li >
                    <a href="../topic-guides/">Guides</a>
                </li>
            
            
            
                <li >
                    <a href="../../reference/reference_guides/">Reference</a>
                </li>
            
            
            
                <!-- <li class="dropdown active"> -->
                <!--     <a href="#" class="dropdown-toggle" data-toggle="dropdown">Topic Guides <b class="caret"></b></a> -->
                <!--     <ul class="dropdown-menu"> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="guides/components_overview/">Component Overview</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="guides/command_line_tool/">Command Line tool</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="guides/discoverable/">Discoverable Features</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li class="active"> -->
                <!--             <a href="guides/plugins/">Plugins</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="guides/plugins_list/">Plugin List</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="guides/datamodel/">Data Model</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="guides/episodes/">Episodes</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="guides/archetypes/">Archetypes</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="guides/referencedata/">Referencedata</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="guides/metadata/">Metadata</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="guides/working_with_data_in_angular/">Angular Models</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="guides/roles_and_permissions/">Roles & Permissions</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="guides/tagging/">Tagging</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="guides/json_api/">JSON API</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="guides/theming/">Theming</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="guides/templates/">Templates</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="guides/context_processors/">Context Processors</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="guides/static_files/">Static Files</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="guides/forms/">Forms</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="guides/patient_detail_views/">Patient Detail Views</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="guides/list_views/">Patient List Views</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="guides/search/">Search Overview</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="guides/pathways/">Pathway Overview</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="guides/django_admin/">Django Admin</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="guides/contributing/">Contributing</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="guides/development_environment/">Development environment</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="guides/releasing/">Releasing</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="guides/deployment/">Deployment</a> -->
                <!--         </li> -->
                <!--      -->
                <!--     </ul> -->
                <!-- </li> -->
            
            
            
                <!-- <li class="dropdown"> -->
                <!--     <a href="#" class="dropdown-toggle" data-toggle="dropdown">Reference <b class="caret"></b></a> -->
                <!--     <ul class="dropdown-menu"> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="reference/episode/">The Episode model</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="reference/patient/">The Patient model</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="reference/subrecords/">Subrecords</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="reference/user_profile_model/">UserProfile</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="reference/mixins/">Mixins</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="reference/opal_application/">OpalApplication</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="reference/detail_views/">Detail Views</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="reference/episode_categories/">Episode Categories</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="reference/schemas/">Schemas</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="reference/patient_list/">Patient Lists</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="reference/plugin/">OpalPlugin</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="reference/core_views/">Core.Views</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="reference/core_menus/">Menus</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="reference/loggers/">Log</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="reference/core_fields/">Fields</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="reference/core_lookuplists/">Lookuplists</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="reference/core_discoverable/">Discoverable</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="reference/core_serialization/">Serialization</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="reference/core_subrecords/">Subrecords</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="reference/javascript/patient_service/">Patient service</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="reference/javascript/episode_service/">Episode service</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="reference/javascript/item_service/">Item service</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="reference/javascript/user_service/">The User service</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="reference/javascript/patient_summary_service/">Patient summary service</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="reference/javascript/search_js_services/">Search JS Services</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="reference/javascript/loaders/">Loaders</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="reference/form_templatetags/">Form helpers</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="reference/panels_templatetags/">Panel Template tags</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="reference/menus_templatetags/">Menu Template tag</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="reference/javascript/javascript_helpers/">Javascript helpers</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="reference/utils/">Utils module</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="reference/search_queries/">Search Queries</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="reference/pathways/">Pathway</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="reference/settings/">Settings</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="reference/changelog/">Changelog</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="reference/testing/">Testing</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="reference/javascript/javascript_dependencies/">Javascript dependencies</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="reference/upgrading/">Upgrading</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="reference/management_commands/">Management commands</a> -->
                <!--         </li> -->
                <!--      -->
                <!--     </ul> -->
                <!-- </li> -->
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
              <li>
                <a href="https://github.com/openhealthcare/opal/tree/v0.18.1" target="_blank">
                  <i class="fa fa-github"></i> v0.18.1
                </a>
              </li>
                <!-- <li class="disabled"> -->
                <!--     <a rel="next" > -->
                <!--         <i class="fa fa-arrow-left"></i> Previous -->
                <!--     </a> -->
                <!-- </li> -->
                <!-- <li class="disabled"> -->
                <!--     <a rel="prev" > -->
                <!--         Next <i class="fa fa-arrow-right"></i> -->
                <!--     </a> -->
                <!-- </li> -->
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
  <h3>Contents</h3>
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#writing-plugins">Writing Plugins</a></li>
        
            <li><a href="#getting-started-with-your-plugin">Getting started with your plugin</a></li>
        
            <li><a href="#adding-discoverable-functionality">Adding Discoverable Functionality</a></li>
        
            <li><a href="#getting-a-plugin-directory">Getting a plugin directory</a></li>
        
            <li><a href="#adding-urls">Adding URLS</a></li>
        
            <li><a href="#adding-javascript">Adding Javascript</a></li>
        
            <li><a href="#adding-apis">Adding APIs</a></li>
        
            <li><a href="#permissioning">Permissioning</a></li>
        
            <li><a href="#adding-actions-to-the-sidebar">Adding Actions to the sidebar</a></li>
        
            <li><a href="#adding-dependencies-globally-to-our-angular-modules">Adding dependencies globally to our angular modules</a></li>
        
            <li><a href="#adding-menu-items">Adding Menu items</a></li>
        
            <li><a href="#installing-plugins">Installing plugins</a></li>
        
            <li><a href="#adding-extra-markup-to-the-tag">Adding extra markup to the  tag</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main"><h2 id="writing-plugins">Writing Plugins</h2>
<p>Opal Plugins are Django apps on the server side, and collections of angular.js
models for the client.</p>
<h3 id="getting-started-with-your-plugin">Getting started with your plugin</h3>
<p>The Opal commandline tool will bootstrap your plugin for you - just run:</p>
<pre><code class="bash">$ opal startplugin yourcoolplugin
</code></pre>

<h3 id="adding-discoverable-functionality">Adding Discoverable Functionality</h3>
<p>A common pattern for plugins is to add functionality that other plugins or applications
can use by inheriting a base class that you define in a file with a magic name. (In
much the same way that Django provides models.)</p>
<p>For example, if you're creating an appointments plugin that helps people to book and schedule
appointments in clinics, you would create a base <code>Clinic</code> class that can be subclassed to
create specific clinics.</p>
<pre><code class="python">class Clinic(opal.core.discoverable.DiscoverableFeature):
    module_name = 'clinics'
</code></pre>

<p>We can then create clinics in any installed app, and they will be available from <code>Clinic.list()</code></p>
<pre><code class="python">class OutpatientsClinic(Clinic):
    name = 'Outpatients'

    # Add your custom clinic functionality here e.g.
    def book_appointment(self, date, patient):
        pass


Clinic.list()
# -&gt; Generator including OutPatientsClinic

Clinic.get('outpatients)
# -&gt; OutpatientsClinic
</code></pre>

<h3 id="getting-a-plugin-directory">Getting a plugin directory</h3>
<p>Each plugin has a <code>directory()</code> method that returns the file system location of the module.</p>
<h3 id="adding-urls">Adding URLS</h3>
<p>Add an urls.py, then add to your plugin class as YourPlugin.urls</p>
<p>Naturally, these can point to views in your plugin!</p>
<h3 id="adding-javascript">Adding Javascript</h3>
<p>Add to static, then add to your plugin class as YourPlugin.javascripts</p>
<p>There are some restricted namespaces for these...</p>
<h3 id="adding-apis">Adding APIs</h3>
<p>Opal uses Django Rest Framework to provide APIs, and you may add to these from your plugin.
By convention, APIs live in <code>yourplugin/api.py</code>. You are expected to provide a
<code>rest_framework.viewsets.ViewSet</code> subclass, which you then detail as the <code>.apis</code> attribute
of your plugin.</p>
<pre><code class="python"># yourplugin/api.py
from rest_framework.viewsets import ViewSet
from rest_framework.response import Response

class PingViewSet(ViewSet):
    def list(self, request): return Response('pong')

# yourplugin/plugin.py
from opal.core.plugins import OpalPlugin
from yourplugin import api

class YourPlugin(OpalPlugin):
    apis = [
        ('ping', api.PingViewSet)
    ]
</code></pre>

<p>These APIs will then be available and self-documenting from the standard Opal url <code>/api/v0.1/</code></p>
<h3 id="permissioning">Permissioning</h3>
<p>Developers are strongly encouraged to ensure that APIs which
serve patient data are restricted to logged in users. Django Rest Framework <code>ViewSet</code> classes
have an <a href="http://www.django-rest-framework.org/api-guide/permissions/">extensive permissioning system</a>.</p>
<p>Opal ships with the base ViewSet class <code>opal.core.api.LoginRequiredViewset</code> which adds the Django
Rest Framework permission class IsAuthenticated to your viewset.</p>
<pre><code class="python">class PingViewSet(LoginRequiredViewset):
    def list(self, request):
        return Response('pong')
</code></pre>

<h3 id="adding-actions-to-the-sidebar">Adding Actions to the sidebar</h3>
<p>Actions can be added to the sidebar by setting the <code>actions</code> attribute of your plugin.
Actions is expected to be an iterable of strings which are templates to be included in
the sidebar. By convention, actions will live in <code>./templates/actions/</code> .</p>
<pre><code class="python"># plugin.py:
class Plugin(OpalPlugin):
    actions = ('actions/javascript_alert.html', 'actions/dummy_button.html')
</code></pre>

<p>And then in the template:</p>
<pre><code class="html">&lt;p ng-show=&quot;episode.category == 'YourEpisodeCategory'&quot;&gt;
  &lt;button class=&quot;btn btn-primary&quot; ng-click=&quot;alert('Boom!')&quot;&gt;
    &lt;i href=&quot;fa fa-warning&quot;&gt;&lt;/i&gt;
    ALERT ME
  &lt;/button&gt;
&lt;/p&gt;
</code></pre>

<h3 id="adding-dependencies-globally-to-our-angular-modules">Adding dependencies globally to our angular modules</h3>
<p>Dependencies listed in <code>angular_module_deps</code> will be added to all Angular modules (as long as they
use the OPAL.module() API. If not, you're on your own. We could monkey patch angular.module, but we
won't for now.</p>
<h3 id="adding-menu-items">Adding Menu items</h3>
<p>Plugins may add items to the main Opal Menu by setting the <code>menuitems</code> attribute.
This attribute should be an iterable of <a href="../../reference/core_menus/"><code>MenuItem</code></a> objects.</p>
<pre><code class="python">from opal.core import menus

class YourPlugin(OpalPlugin):
    menuitems = [
        menus.MenuItem(href=&quot;/your-url&quot;, icon=&quot;fa-user&quot;)
    ]
</code></pre>

<h3 id="installing-plugins">Installing plugins</h3>
<ul>
<li>
<p>Add the plugin's name to the <code>INSTALLED_APPS</code> list in your <code>settings.py</code></p>
</li>
<li>
<p>Add the plugin's name to <code>requirements.txt</code> and run <code>pip install -r requirements.txt</code> (if appropriate, eg if you are distributing your plugin via Pypi or GitHub) </p>
</li>
</ul>
<h3 id="adding-extra-markup-to-the-tag">Adding extra markup to the <head> tag</h3>
<p>Any templates you define in the property .head_extra will be included in the <head></p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <img src="/img/opallogo.png" class="pull-left"/>
            <center>
              <br />
              Opal is an open source framework for building clinical applications from
              <a href="http://openhealthcare.org.uk" target="_blank">Open Health Care UK</i></a>.
            </center>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"search": 83, "next": 78, "help": 191, "previous": 80};
        </script>

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        <script src="../../search/main.js"></script>
          <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-35112560-5', 'openhealthcare.org.uk');
  ga('send', 'pageview');
          </script>

    </body>
</html>