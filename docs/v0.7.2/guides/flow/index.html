<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Flow - OPAL</title>
        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/purebasic.min.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="../..">OPAL</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li >
                                <a href="../..">Home</a>
                            </li>
                            <li >
                                <a href="../../installation/">Installation</a>
                            </li>
                            <li >
                                <a href="../../tutorial/">Tutorial</a>
                            </li>
                            <li >
                                <a href="../topic-guides/">Guides</a>
                            </li>
                            <li >
                                <a href="../../reference/reference_guides/">Reference</a>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Topic Guides <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../components_overview/">Component Overview</a>
</li>
                                    
<li >
    <a href="../command_line_tool/">Command Line tool</a>
</li>
                                    
<li >
    <a href="../plugins/">Plugins</a>
</li>
                                    
<li >
    <a href="../plugins_list/">Plugin List</a>
</li>
                                    
<li >
    <a href="../datamodel/">Data Model</a>
</li>
                                    
<li >
    <a href="../archetypes/">Archetypes</a>
</li>
                                    
<li >
    <a href="../working_with_data_in_angular/">Angular Models</a>
</li>
                                    
<li class="active">
    <a href="./">Flow</a>
</li>
                                    
<li >
    <a href="../roles_and_permissions/">Roles & Permissions</a>
</li>
                                    
<li >
    <a href="../tagging/">Tagging</a>
</li>
                                    
<li >
    <a href="../json_api/">JSON API</a>
</li>
                                    
<li >
    <a href="../referencedata/">Referencedata</a>
</li>
                                    
<li >
    <a href="../metadata/">Metadata</a>
</li>
                                    
<li >
    <a href="../lookup_lists/">Lookup Lists</a>
</li>
                                    
<li >
    <a href="../templates/">Templates</a>
</li>
                                    
<li >
    <a href="../context_processors/">Context Processors</a>
</li>
                                    
<li >
    <a href="../static_files/">Static Files</a>
</li>
                                    
<li >
    <a href="../forms/">Forms</a>
</li>
                                    
<li >
    <a href="../patient_detail_views/">Patient Detail Views</a>
</li>
                                    
<li >
    <a href="../list_views/">Patient List Views</a>
</li>
                                    
<li >
    <a href="../discoverable/">Discoverable Features</a>
</li>
                                    
<li >
    <a href="../search/">Search Overview</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Reference <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../reference/episode/">The Episode model</a>
</li>
                                    
<li >
    <a href="../../reference/episode_categories/">Episode Categories</a>
</li>
                                    
<li >
    <a href="../../reference/patient/">Patient</a>
</li>
                                    
<li >
    <a href="../../reference/subrecords/">Subrecords</a>
</li>
                                    
<li >
    <a href="../../reference/mixins/">Mixins</a>
</li>
                                    
<li >
    <a href="../../reference/opal_application/">OpalApplication</a>
</li>
                                    
<li >
    <a href="../../reference/episode_service/">Episode service</a>
</li>
                                    
<li >
    <a href="../../reference/item_service/">Item service</a>
</li>
                                    
<li >
    <a href="../../reference/patient_summary_service/">Patient summary service</a>
</li>
                                    
<li >
    <a href="../../reference/form_templatetags/">Form helpers</a>
</li>
                                    
<li >
    <a href="../../reference/panels_templatetags/">Panel Template tags</a>
</li>
                                    
<li >
    <a href="../../reference/javascript_helpers/">Javascript helpers</a>
</li>
                                    
<li >
    <a href="../../reference/javascript_dependencies/">Javascript dependencies</a>
</li>
                                    
<li >
    <a href="../../reference/schemas/">Schemas</a>
</li>
                                    
<li >
    <a href="../../reference/search_queries/">Search Queries</a>
</li>
                                    
<li >
    <a href="../../reference/detail_views/">Detail Views</a>
</li>
                                    
<li >
    <a href="../../reference/patient_list/">Patient Lists</a>
</li>
                                    
<li >
    <a href="../../reference/search_js_services/">Search JS Services</a>
</li>
                                    
<li >
    <a href="../../reference/changelog.md">Changelog</a>
</li>
                                    
<li >
    <a href="../../reference/upgrading/">Upgrading</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li >
                                <a rel="next" href="../working_with_data_in_angular/">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li >
                                <a rel="prev" href="../roles_and_permissions/">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#flow-hooks-in-opal">Flow hooks in OPAL</a></li>
            <li><a href="#the-flow-service">The Flow service</a></li>
            <li><a href="#the-enter-verb">The enter verb</a></li>
            <li><a href="#the-exit-verb">The exit verb</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="flow-hooks-in-opal">Flow hooks in OPAL</h1>
<p>OPAL provides various hooks that developers can use to customise behaviour at certain key points in a
patient's journey through a clinical service - for example when a patient is discharged.</p>
<p>These hooks are associated with verbs <code>enter</code>, <code>exit</code>.</p>
<h3 id="the-flow-service">The Flow service</h3>
<p>Your application scaffold will have created a file at
<code>./yourapp/assets/js/yourapp/services/flow.js</code>. This file will declare an angular service that
your application will use to determine how to move to the correct next step for a patient.</p>
<p>To enable this, we must set the following setting:</p>
<pre><code class="python"># settings.py
OPAL_FLOW_SERVICE = 'MyAppFlow'
</code></pre>

<p>Flow services must define an <code>enter</code> and an <code>exit</code> method, which both return the appropriate
angular controller and template to use. Although OPAL provides sensible default controllers and
templates for these common actions, applications with custom flows may customise these methods
as required.</p>
<h3 id="the-enter-verb">The enter verb</h3>
<p>The enter verb is called when a patient is added to a service - for instance by adding a patient to a team list.</p>
<p>Implementations of enter are expected to return a dictionary of the controller and template they wish to be called.</p>
<pre><code>enter: function(){
        return {
            'controller': 'HospitalNumberCtrl',
            'template'  : '/templates/modals/hospital_number.html/'
        }
    }
</code></pre>
<p>A common strategy is to examine angular <code>$route</code> or <code>$routeParams</code> to determine where the user is in the application.
For instance you may wish to have custom controllers for a particular patient list, or the search results page.</p>
<h3 id="the-exit-verb">The exit verb</h3>
<p>The exit verb is called when a patient is moving through a service - for instance when we discharge a patient, or end
one phase of a clinical pathway.</p>
<p>Implementations of exit are expected to return a dictionary of the controller and template they wish to be called.</p>
<p>The enter verb will receive the episode that we are acting on - for instance a controller that acts differently for
deceased patients might look as follows</p>
<pre><code>exit: function(episode){
      if(episode.demographics[0].deceased){
          return {
              'controller': 'DeceasedDischargeEpisodeCtrl',
              'template'  : '/templates/modals/deceased_discharge.html/'
          }
      }
      return {
          'controller': 'DischargeEpisodeCtrl',
          'template'  : '/templates/modals/discharge_episode.html/'
      }
    }
</code></pre></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
