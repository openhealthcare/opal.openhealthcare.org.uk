<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">

	<title>Plugins - OPAL</title>

        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../css/base.css" rel="stylesheet">
        <link href="../../opaldocs.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="../..">
              <img src="/img/opallogo.png" height="30"/>
            </a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li >
                    <a href="../..">Home</a>
                </li>
            
            
            
                <li >
                    <a href="../../installation/">Installation</a>
                </li>
            
            
            
                <li >
                    <a href="../../tutorial/">Tutorial</a>
                </li>
            
            
            
                <li >
                    <a href="../topic-guides/">Guides</a>
                </li>
            
            
            
                <li >
                    <a href="../../reference/reference_guides/">Reference</a>
                </li>
            
            
            
                <!-- <li class="dropdown active"> -->
                <!--     <a href="#" class="dropdown-toggle" data-toggle="dropdown">Topic Guides <b class="caret"></b></a> -->
                <!--     <ul class="dropdown-menu"> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="../components_overview/">Component Overview</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="../command_line_tool/">Command Line tool</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li class="active"> -->
                <!--             <a href="./">Plugins</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="../plugins_list/">Plugin List</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="../datamodel/">Data Model</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="../flow/">Flow</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="../roles_and_permissions/">Roles & Permissions</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="../teams/">Teams</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="../json_api/">JSON API</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="../lookup_lists/">Lookup Lists</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="../templates/">Templates</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="../static_files/">Static Files</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="../forms/">Forms</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="../episode_detail_views/">Episode Detail Views</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="../list_views/">Patient List Views</a> -->
                <!--         </li> -->
                <!--      -->
                <!--     </ul> -->
                <!-- </li> -->
            
            
            
                <!-- <li class="dropdown"> -->
                <!--     <a href="#" class="dropdown-toggle" data-toggle="dropdown">Reference <b class="caret"></b></a> -->
                <!--     <ul class="dropdown-menu"> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="../../reference/episode/">The Episode model</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="../../reference/patient/">Patient</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="../../reference/subrecords/">Subrecords</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="../../reference/team/">Team</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="../../reference/opal_application/">OpalApplication</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="../../reference/episode_service/">Episode service</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="../../reference/item_service/">Item service</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="../../reference/patient_summary_service/">Patient summary service</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="../../reference/form_templatetags/">Form helpers</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="../../reference/record_panel_templatetag/">Record panel templatetag</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="../../reference/javascript_helpers/">Javascript helpers</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="../../reference/schemas/">Schemas</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="../../reference/search_queries/">Search Queries</a> -->
                <!--         </li> -->
                <!--      -->
                <!--         <li > -->
                <!--             <a href="../../reference/upgrading/">Upgrading</a> -->
                <!--         </li> -->
                <!--      -->
                <!--     </ul> -->
                <!-- </li> -->
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
              <li>
                <a href="https://github.com/openhealthcare/opal/tree/v0.5.6" target="_blank">
                  <i class="fa fa-github"></i> v0.5.6
                </a>
              </li>
                <!-- <li > -->
                <!--     <a rel="next" href="../command_line_tool/"> -->
                <!--         <i class="fa fa-arrow-left"></i> Previous -->
                <!--     </a> -->
                <!-- </li> -->
                <!-- <li > -->
                <!--     <a rel="prev" href="../plugins_list/"> -->
                <!--         Next <i class="fa fa-arrow-right"></i> -->
                <!--     </a> -->
                <!-- </li> -->
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
  <h3>Contents</h3>
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#writing-plugins">Writing Plugins</a></li>
        
            <li><a href="#getting-started-with-your-plugin">Getting started with your plugin</a></li>
        
            <li><a href="#defining-teams">Defining teams</a></li>
        
            <li><a href="#defining-schemas">Defining Schemas</a></li>
        
            <li><a href="#defining-new-flows">Defining new flows</a></li>
        
            <li><a href="#adding-urls">Adding URLS</a></li>
        
            <li><a href="#adding-javascript">Adding Javascript</a></li>
        
            <li><a href="#adding-apis">Adding APIs</a></li>
        
            <li><a href="#adding-actions-to-the-sidebar">Adding Actions to the sidebar</a></li>
        
            <li><a href="#adding-dependencies-globally-to-our-angular-modules">Adding dependencies globally to our angular modules</a></li>
        
            <li><a href="#installing-plugins">Installing plugins</a></li>
        
            <li><a href="#adding-extra-markup-to-the-tag">Adding extra markup to the  tag</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<h2 id="writing-plugins">Writing Plugins</h2>
<p>OPAL Plugins are Django apps on the server side, and collections of angular.js
models for the client. </p>
<h3 id="getting-started-with-your-plugin">Getting started with your plugin</h3>
<p>The OPAL commandline tool will bootstrap your plugin for you - just run: </p>
<pre><code>$ opal startplugin yourcoolplugin
</code></pre>
<h3 id="defining-teams">Defining teams</h3>
<p>As a signal is fine.
Data migrations might work.</p>
<p>Defining restricted team access is done by:</p>
<p>Adding a method to your pluigin that takes one argument, a User object, and returning a set of
extra teams that this user is allowed to see.</p>
<h3 id="defining-schemas">Defining Schemas</h3>
<p>Plugins can define list schemas to be used to generate patient lists. 
They should return a dictionary of lists of models from the
<code>list_schemas</code> method of the plugin class.</p>
<pre><code># yourplugin/__init__.py
from opal.core.plugins import OpalPlugin

from yourplugin import models

class YourPlugin(OpalPlugin):
    def list_schemas(self):
        columns = [models.YourAwesomeModel, models.YourSecondModel, models.SomeOtherModel]
        return {'yourplugin': {'default': columns}}
</code></pre>
<h3 id="defining-new-flows">Defining new flows</h3>
<p>Plugins can define flows. They should return a dictionary of flows from the 
flows() method of the plugin class.</p>
<h3 id="adding-urls">Adding URLS</h3>
<p>Add an urls.py, then add to your plugin class as YourPlugin.urls</p>
<p>Naturally, these can point to views in your plugin! </p>
<h3 id="adding-javascript">Adding Javascript</h3>
<p>add to static, then add to your plugin class as YourPlugin.javascripts</p>
<p>There are some restricted namespaces for these...</p>
<h3 id="adding-apis">Adding APIs</h3>
<p>OPAL uses Django Rest Framweork to provide APIs, and you may add to these from your plugin.
By convention, APIs live in <code>yourplugin/api.py</code>. You are expected to provide a
<code>rest_framework.viewsets.ViewSet</code> subclass, which you then detail as the <code>.apis</code> attribute
of your plugin.</p>
<pre><code># yourplugin/api.py
from rest_framework.viewsets import ViewSet
from rest_framework.response import Response

class PingViewSet(ViewSet):
    def list(self, request): return Response('pong')

# yourplugin/__init__.py
from opal.core.plugins import OpalPlugin
from yourplugin import api

class YourPlugin(OpalPlugin):
    apis = [
        ('ping', api.PingViewSet)
    ]
</code></pre>
<p>These APIs will then be available and self-documenting fom the standard OPAL url <code>/api/v0.1/</code></p>
<h3 id="adding-actions-to-the-sidebar">Adding Actions to the sidebar</h3>
<p>Actions can be added to the sidebar by setting the <code>actions</code> attribute of your plugin.
Actions is expected to be an iterable of strings which are templates to be included in
the sidebar. By convention, actions will live in <code>./templates/actions/</code> .</p>
<pre><code># __init__.py:
class Plugin(OpalPlugin):
    actions = ('actions/javascript_alert.html', 'actions/dummy_button.html')
</code></pre>
<p>And then in the template:</p>
<pre><code>&lt;p ng-show="episode.category == 'YourEpisodeCategory'"&gt;
  &lt;button class="btn btn-primary" ng-click="alert('Boom!')"&gt;
    &lt;i href="fa fa-warning"&gt;&lt;/i&gt;
    ALERT ME
  &lt;/button&gt;    
&lt;/p&gt;
</code></pre>
<h3 id="adding-dependencies-globally-to-our-angular-modules">Adding dependencies globally to our angular modules</h3>
<p>Dependencies listed in <code>angular_module_deps</code> will be added to all Angular modules (as long as they
use the OPAL.module() API. If not, you're on your own. We could monkey patch angular.module, but we
won't for now.</p>
<h3 id="installing-plugins">Installing plugins</h3>
<p>Add to installed apps
Add to requirements if appropriate</p>
<h3 id="adding-extra-markup-to-the-tag">Adding extra markup to the <head> tag</h3>
<p>Any templates you define in the property .head_extra will be included in the <head></p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <img src="/img/opallogo.png" class="pull-left"/>
            <center>
              <br />
              OPAL is an Open Source framework for building clinical applications from
              <a href="http://openhealthcare.org.uk" target="_blank">Open Health Care UK</i></a>.
            </center>
        </footer>

        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script src="../../js/base.js"></script>
          <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-35112560-5', 'openhealthcare.org.uk');
  ga('send', 'pageview');
          </script>

    </body>
</html>